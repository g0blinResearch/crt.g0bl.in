# Certificate Transparency Stream Subscriber

A Node.js application that subscribes to Certificate Transparency logs in real-time and outputs certificate data to the terminal.

## Overview

This project connects to Certificate Transparency logs, processes the certificate data in real-time, and outputs it in a configurable format (JSON or human-readable text).

Certificate Transparency (CT) is a system for logging and monitoring the issuance of digital certificates. This helps detect mistakenly or maliciously issued certificates and provides transparency into the CA ecosystem.

## AI-Generated Project

**Disclaimer**: This project was generated by Claude 3.7, an AI assistant by Anthropic. The entire implementation, from planning to code, was created through a dialogue with the AI.

For transparency, the complete conversation that led to this implementation is available in the file [cline_claude_3.7_task_mar-4-2025_6-26-28-pm.md](./cline_claude_3.7_task_mar-4-2025_6-26-28-pm.md) included in this repository. This document shows the iterative process, including planning, debugging, and enhancements that shaped the final result.

## Installation

### Prerequisites

- Node.js (>= 14.0.0)
- npm (comes with Node.js)

### Steps

1. Clone the repository:
   ```bash
   git clone https://github.com/g0blinResearch/crt.g0bl.in.git
   cd crt.g0bl.lin
   ```

2. Install dependencies:
   ```bash
   npm install
   ```

3. (Optional) Create a `.env` file for environment-specific configurations:
   ```bash
   touch .env
   ```

   Example `.env` file content:
   ```
   LOG_LEVEL=info
   CERTSTREAM_WS_URL=wss://certstream.calidog.io/
   ENABLED_PROVIDERS=certstream
   OUTPUT_TYPE=json
   OUTPUT_FORMAT=pretty
   ```

4. Make the executable file runnable:
   ```bash
   chmod +x src/index.js
   ```

## Usage

```bash
node src/index.js [options]
```

Or using the npm scripts:

```bash
npm start           # Start with default settings
npm run dev         # Start with debug log level
npm run start:json  # Start with JSON output format
npm run start:text  # Start with text output format
```

### Passing Options to npm Scripts

To pass command-line options to npm scripts, use the `--` separator followed by your options:

```bash
# Add file output to the default start command
npm start -- --output-file ./logs/certificates.json

# Use a custom WebSocket URL with the dev command
npm run dev -- --url wss://example.com/stream --output-file ./logs/debug.json

# Change the output format when using start:json
npm run start:json -- --output-format raw

# Add file output to the text formatter
npm run start:text -- --output-file ./logs/certificates.txt

# Use quiet mode with any script
npm start -- --quiet
```

This approach works because npm passes any arguments after the `--` directly to the underlying command defined in the script.

### Options

- `-l, --log-level <level>` - Set logging level (debug, info, warn, error) (default: "info")
- `-u, --url <url>` - CertStream WebSocket URL (default: "wss://certstream.calidog.io/")
- `-p, --providers <list>` - Comma-separated list of enabled providers (default: "certstream")
- `-i, --polling-interval <ms>` - Polling interval in milliseconds for HTTP providers (default: "60000")
- `-m, --max-entries <number>` - Maximum entries to fetch per request (default: "100")
- `-t, --output-type <type>` - Output type (json, text) (default: "json")
- `-f, --output-format <format>` - Output format (pretty, raw) (default: "pretty")
- `-o, --output-file <path>` - Output file path (default: terminal output only)
- `-q, --quiet` - Output only certificate data, no logs or status messages (default: false)
- `-h, --help` - Display help for command
- `-V, --version` - Display version number

## Examples

Display certificates in JSON format with debug logs:
```bash
node src/index.js --log-level debug --output-type json
```

Display certificates in human-readable text format:
```bash
node src/index.js --output-type text
```

Write certificates to a file while displaying in the terminal:
```bash
node src/index.js --output-file ./logs/certificates.log
```

Output in pretty JSON format to the terminal but save as single-line JSON to file (ideal for log processing):
```bash
node src/index.js --output-type json --output-format pretty --output-file ./logs/certificates.json
```

Run in quiet mode (certificate data only):
```bash
node src/index.js --quiet
```

## File Output

The application can write certificate data to a file in addition to displaying it in the terminal:

- If `--output-file` is specified, each certificate will be written to the file
- Output is appended to the file with one certificate per line
- Directory structure will be created automatically if it doesn't exist
- For JSON output in pretty mode, the file will contain single-line JSON objects (better for log processing)
- For text output, the formatted text is written without ANSI color codes (better for log files)

This feature is useful for:
- Creating a persistent log of certificates
- Building datasets for analysis
- Integration with other log processing systems
- Long-running monitoring operations

## Scripting and Piping

The `--quiet` option makes the application ideal for use in scripts and pipelines by outputting only the certificate data (without any log messages, status updates, or other output). This clean output can be easily piped to other tools for filtering, processing, or analysis.

Examples of using crt.g0bl.in in scripts:

```bash
# Pipe JSON certificates to jq for filtering
node src/index.js --quiet | jq 'select(.data.leaf_cert.subject.CN | contains("example.com"))'

# Save raw certificates to a file while also viewing filtered ones
node src/index.js --quiet | tee all-certs.json | grep "example.com"

# Count certificates matching a pattern
node src/index.js --quiet | grep -c "Let's Encrypt"

# Format and transform with awk
node src/index.js --quiet --output-type text | awk '/Domain:/ {print $2}' > domains.txt
```

The quiet mode ensures that only the actual certificate data is output, making it easier to process with standard Unix tools or custom scripts without having to filter out log messages.

## Architecture

The application is structured into several key components:

1. **Providers** - Interface with different CT log sources
   - `base-provider.js` - Abstract base class for all providers
   - `certstream-provider.js` - Provider that connects to CertStream WebSocket
   - `provider-factory.js` - Factory for creating provider instances

2. **Formatters** - Format certificate data for output
   - `json-formatter.js` - Formats certificates as JSON
   - `text-formatter.js` - Formats certificates as human-readable text

3. **Core Components**
   - `config.js` - Configuration management
   - `logger.js` - Logging system with multiple levels

## Extending

### Adding New Providers

To add support for additional CT log sources, create a new provider class that extends `BaseProvider` and implements the required methods:

1. Create a new file in `src/providers/`, e.g., `google-provider.js`
2. Extend the `BaseProvider` class and implement required methods
3. Update `provider-factory.js` to support the new provider

### Adding New Formatters

To add support for additional output formats:

1. Create a new file in `src/formatters/`, e.g., `csv-formatter.js`
2. Implement the formatter interface with methods like `formatCertificate()`
3. Update `index.js` to support the new formatter

## License

This project is licensed under the MIT License - see the LICENSE file for details.